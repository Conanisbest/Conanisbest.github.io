<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />

    

    
    <title>Java多线程学习 | Conan的博客</title>
    
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="keywords" content="java" />
    
    <meta name="description" content="Java总结篇系列：Java多线程（一） 多线程作为Java中很重要的一个知识点，在此还是有必要总结一下的。 一.线程的生命周期及五种基本状态 关于Java中线程的生命周期，首先看一下下面这张较为经典的图：  上图中基本上囊括了Java中多线程各重要知识点。掌握了上图中的各知识点，Java中的多线程也就基本上掌握了。主要包括： Java线程具有五种基本状态 新建状态（New）：当线程对象对创建后，">
<meta property="og:type" content="article">
<meta property="og:title" content="Java多线程学习">
<meta property="og:url" content="https://conanisbest.github.io/2020/07/02/second/index.html">
<meta property="og:site_name" content="Conan的博客">
<meta property="og:description" content="Java总结篇系列：Java多线程（一） 多线程作为Java中很重要的一个知识点，在此还是有必要总结一下的。 一.线程的生命周期及五种基本状态 关于Java中线程的生命周期，首先看一下下面这张较为经典的图：  上图中基本上囊括了Java中多线程各重要知识点。掌握了上图中的各知识点，Java中的多线程也就基本上掌握了。主要包括： Java线程具有五种基本状态 新建状态（New）：当线程对象对创建后，">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://conanisbest.github.io/2020/07/02/second/2020/07/02/first/sz.png">
<meta property="article:published_time" content="2020-07-02T07:18:50.000Z">
<meta property="article:modified_time" content="2020-07-03T08:16:44.278Z">
<meta property="article:author" content="John Doe">
<meta property="article:tag" content="java">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://conanisbest.github.io/2020/07/02/second/2020/07/02/first/sz.png">
    

    
        <link rel="alternate" href="/" title="Conan的博客" type="application/atom+xml" />
    

    
        <link rel="icon" href="/css/images/bitbug_favicon.ico" />
    

    
<link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css">

    
<link rel="stylesheet" href="/libs/titillium-web/styles.css">

    
<link rel="stylesheet" href="/libs/source-code-pro/styles.css">


    
<link rel="stylesheet" href="/css/style.css">


    
<script src="/libs/jquery/3.5.0/jquery.min.js"></script>

    
    
        
<link rel="stylesheet" href="/libs/lightgallery/css/lightgallery.min.css">

    
    
        
<link rel="stylesheet" href="/libs/justified-gallery/justifiedGallery.min.css">

    
    
    
    


<meta name="generator" content="Hexo 4.2.1"></head>

<body>
    <div id="wrap">
        <header id="header">
    <div id="header-outer" class="outer">
        <div class="container">
            <div class="container-inner">
                <div id="header-title">
                    <h1 class="logo-wrap">
                        <a href="/" class="logo"></a>
                    </h1>
                    
                </div>
                <div id="header-inner" class="nav-container">
                    <a id="main-nav-toggle" class="nav-icon fa fa-bars"></a>
                    <div class="nav-container-inner">
                        <ul id="main-nav">
                            
                                <li class="main-nav-list-item" >
                                    <a class="main-nav-list-link" href="/">Home</a>
                                </li>
                            
                                        
                                    
                                <li class="main-nav-list-item" >
                                    <a class="main-nav-list-link" href="/about/index.html">About</a>
                                </li>
                            
                        </ul>
                        <nav id="sub-nav">
                            <div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="Search" />
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="Type something..." />
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'Posts',
            PAGES: 'Pages',
            CATEGORIES: 'Categories',
            TAGS: 'Tags',
            UNTITLED: '(Untitled)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>

<script src="/js/insight.js"></script>


</div>
                        </nav>
                    </div>
                </div>
            </div>
        </div>
    </div>
</header>
        <div class="container">
            <div class="main-body container-inner">
                <div class="main-body-inner">
                    <section id="main">
                        <div class="main-body-header">
    <h1 class="header">
    
    uncategorized
    </h1>
</div>

                        <div class="main-body-content">
                            <article id="post-second" class="article article-single article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
            <header class="article-header">
                
    
        <h1 class="article-title" itemprop="name">
        Java多线程学习
        </h1>
    

            </header>
        
        
            <div class="article-meta">
                
    <div class="article-date">
      <i class="fa fa-calendar"></i>
      <a href="/2020/07/02/second/" class="article-date">
         <time datetime="2020-07-02T07:18:50.000Z" itemprop="datePublished">2020-07-02</time>
      </a>
    </div>


                

                
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/java/" rel="tag">java</a>
    </div>

                

                
   <div class="article-counter">
      <i class="fa fa-file-word-o"></i>
      <span class="post-count-item-text">Symbols count in article: </span>
      <span class="post-count">7.5k</span>
      <i class="fa fa-clock-o"></i>
      <span class="post-time-item-text">Reading time: </span>
      <span class="post-count">32 mins. </span>
   </div>


            </div>
        
        
        <div class="article-entry" itemprop="articleBody">
            

            

            

            <p><a href="https://www.cnblogs.com/lwbqqyumidi/p/3804883.html" target="_blank" rel="noopener"><strong>Java总结篇系列：Java多线程（一）</strong></a></p>
<p>多线程作为Java中很重要的一个知识点，在此还是有必要总结一下的。</p>
<p><strong>一.线程的生命周期及五种基本状态</strong></p>
<p>关于Java中线程的生命周期，首先看一下下面这张较为经典的图：</p>
<p><img src="/2020/07/02/second/Users/Administrator/AppData/Local/YNote/data/qq603F12696BD3B57EFA011C366B93AE8F/db1bed93290b4791a8d98f1706a78eb7/02051747387.jpeg" alt="img"></p>
<p>上图中基本上囊括了Java中多线程各重要知识点。掌握了上图中的各知识点，Java中的多线程也就基本上掌握了。主要包括：</p>
<p><strong>Java线程具有五种基本状态</strong></p>
<p><strong>新建状态（New）：</strong>当线程对象对创建后，即进入了新建状态，如：Thread t = new MyThread();</p>
<p><strong>就绪状态（Runnable）：</strong>当调用线程对象的start()方法（t.start();），线程即进入就绪状态。处于就绪状态的线程，只是说明此线程已经做好了准备，随时等待CPU调度执行，并不是说执行了t.start()此线程立即就会执行；</p>
<p><strong>运行状态（Running）：</strong>当CPU开始调度处于就绪状态的线程时，此时线程才得以真正执行，即进入到运行状态。注：就绪状态是进入到运行状态的唯一入口，也就是说，线程要想进入运行状态执行，首先必须处于就绪状态中；</p>
<p><strong>阻塞状态（Blocked）：</strong>处于运行状态中的线程由于某种原因，暂时放弃对CPU的使用权，停止执行，此时进入阻塞状态，直到其进入到就绪状态，才 有机会再次被CPU调用以进入到运行状态。根据阻塞产生的原因不同，阻塞状态又可以分为三种：</p>
<p>1.等待阻塞：运行状态中的线程执行wait()方法，使本线程进入到等待阻塞状态；</p>
<p>2.同步阻塞 – 线程在获取synchronized同步锁失败(因为锁被其它线程所占用)，它会进入同步阻塞状态；</p>
<p>3.其他阻塞 – 通过调用线程的sleep()或join()或发出了I/O请求时，线程会进入到阻塞状态。当sleep()状态超时、join()等待线程终止或者超时、或者I/O处理完毕时，线程重新转入就绪状态。</p>
<p><strong>死亡状态（Dead）：</strong>线程执行完了或者因异常退出了run()方法，该线程结束生命周期。</p>
<p><strong>二. Java多线程的创建及启动</strong></p>
<p>Java中线程的创建常见有如三种基本形式</p>
<p><strong>1.继承Thread类，重写该类的run()方法。</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> <span class="number">1</span> <span class="class"><span class="keyword">class</span> <span class="title">MyThread</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line"> <span class="number">2</span>     </span><br><span class="line"> <span class="number">3</span>     <span class="keyword">private</span> <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line"> <span class="number">4</span> </span><br><span class="line"> <span class="number">5</span>     <span class="meta">@Override</span></span><br><span class="line"> <span class="number">6</span>     <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line"> <span class="number">7</span>         <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line"> <span class="number">8</span>             System.out.println(Thread.currentThread().getName() + <span class="string">" "</span> + i);</span><br><span class="line"> <span class="number">9</span>         &#125;</span><br><span class="line"><span class="number">10</span>     &#125;</span><br><span class="line"><span class="number">11</span> &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"> <span class="number">1</span> <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadTest</span> </span>&#123;</span><br><span class="line"> <span class="number">2</span> </span><br><span class="line"> <span class="number">3</span>     <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"> <span class="number">4</span>         <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line"> <span class="number">5</span>             System.out.println(Thread.currentThread().getName() + <span class="string">" "</span> + i);</span><br><span class="line"> <span class="number">6</span>             <span class="keyword">if</span> (i == <span class="number">30</span>) &#123;</span><br><span class="line"> <span class="number">7</span>                 Th;                     <span class="comment">// 调用start()方法使得线程进入就绪状态</span></span><br><span class="line"><span class="number">11</span>             &#125;</span><br><span class="line"><span class="number">12</span>         &#125;</span><br><span class="line"><span class="number">13</span>     &#125;</span><br><span class="line"><span class="number">14</span> &#125;</span><br><span class="line">read myThread1 = <span class="keyword">new</span> MyThread();     <span class="comment">// 创建一个新的线程  myThread1  此线程进入新建状态</span></span><br><span class="line"> <span class="number">8</span>                 Thread myThread2 = <span class="keyword">new</span> MyThread();     <span class="comment">// 创建一个新的线程 myThread2 此线程进入新建状态</span></span><br><span class="line"> <span class="number">9</span>                 myThread1.start();                     <span class="comment">// 调用start()方法使得线程进入就绪状态</span></span><br><span class="line"><span class="number">10</span>                 myThread2.start()</span><br></pre></td></tr></table></figure>



<p>如上所示，继承Thread类，通过重写run()方法定义了一个新的线程类MyThread，其中run()方法的方法体代表了线程需要完成的任务，称之为线程执行体。当创建此线程类对象时一个新的线程得以创建，并进入到线程新建状态。通过调用线程对象引用的start()方法，使得该线程进入到就绪状态，此时此线程并不一定会马上得以执行，这取决于CPU调度时机。</p>
<p><strong>2.实现Runnable接口，并重写该接口的run()方法，该run()方法同样是线程执行体，创建Runnable实现类的实例，并以此实例作为Thread类的target来创建Thread对象，该Thread对象才是真正的线程对象。</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> <span class="number">1</span> <span class="class"><span class="keyword">class</span> <span class="title">MyRunnable</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line"> <span class="number">2</span>     <span class="keyword">private</span> <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line"> <span class="number">3</span> </span><br><span class="line"> <span class="number">4</span>     <span class="meta">@Override</span></span><br><span class="line"> <span class="number">5</span>     <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line"> <span class="number">6</span>         <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line"> <span class="number">7</span>             System.out.println(Thread.currentThread().getName() + <span class="string">" "</span> + i);</span><br><span class="line"> <span class="number">8</span>         &#125;</span><br><span class="line"> <span class="number">9</span>     &#125;</span><br><span class="line"><span class="number">10</span> &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadTest</span> </span>&#123;</span><br><span class="line"> <span class="number">2</span> </span><br><span class="line"> <span class="number">3</span>     <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"> <span class="number">4</span>         <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line"> <span class="number">5</span>             System.out.println(Thread.currentThread().getName() + <span class="string">" "</span> + i);</span><br><span class="line"> <span class="number">6</span>             <span class="keyword">if</span> (i == <span class="number">30</span>) &#123;</span><br><span class="line"> <span class="number">7</span>                 Runnable myRunnable = <span class="keyword">new</span> MyRunnable(); <span class="comment">// 创建一个Runnable实现类的对象</span></span><br><span class="line"> <span class="number">8</span>                 Thread thread1 = <span class="keyword">new</span> Thread(myRunnable); <span class="comment">// 将myRunnable作为Thread target创建新的线程</span></span><br><span class="line"> <span class="number">9</span>                 Thread thread2 = <span class="keyword">new</span> Thread(myRunnable);</span><br><span class="line"><span class="number">10</span>                 thread1.start(); <span class="comment">// 调用start()方法使得线程进入就绪状态</span></span><br><span class="line"><span class="number">11</span>                 thread2.start();</span><br><span class="line"><span class="number">12</span>             &#125;</span><br><span class="line"><span class="number">13</span>         &#125;</span><br><span class="line"><span class="number">14</span>     &#125;</span><br><span class="line"><span class="number">15</span> &#125;</span><br></pre></td></tr></table></figure>



<p>相信以上两种创建新线程的方式大家都很熟悉了，那么Thread和Runnable之间到底是什么关系呢？我们首先来看一下下面这个例子。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"> <span class="number">1</span> <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadTest</span> </span>&#123;</span><br><span class="line"> <span class="number">2</span> </span><br><span class="line"> <span class="number">3</span>     <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"> <span class="number">4</span>         <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line"> <span class="number">5</span>             System.out.println(Thread.currentThread().getName() + <span class="string">" "</span> + i);</span><br><span class="line"> <span class="number">6</span>             <span class="keyword">if</span> (i == <span class="number">30</span>) &#123;</span><br><span class="line"> <span class="number">7</span>                 Runnable myRunnable = <span class="keyword">new</span> MyRunnable();</span><br><span class="line"> <span class="number">8</span>                 Thread thread = <span class="keyword">new</span> MyThread(myRunnable);</span><br><span class="line"> <span class="number">9</span>                 thread.start();</span><br><span class="line"><span class="number">10</span>             &#125;</span><br><span class="line"><span class="number">11</span>         &#125;</span><br><span class="line"><span class="number">12</span>     &#125;</span><br><span class="line"><span class="number">13</span> &#125;</span><br><span class="line"><span class="number">14</span> </span><br><span class="line"><span class="number">15</span> <span class="class"><span class="keyword">class</span> <span class="title">MyRunnable</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line"><span class="number">16</span>     <span class="keyword">private</span> <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line"><span class="number">17</span> </span><br><span class="line"><span class="number">18</span>     <span class="meta">@Override</span></span><br><span class="line"><span class="number">19</span>     <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="number">20</span>         System.out.println(<span class="string">"in MyRunnable run"</span>);</span><br><span class="line"><span class="number">21</span>         <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line"><span class="number">22</span>             System.out.println(Thread.currentThread().getName() + <span class="string">" "</span> + i);</span><br><span class="line"><span class="number">23</span>         &#125;</span><br><span class="line"><span class="number">24</span>     &#125;</span><br><span class="line"><span class="number">25</span> &#125;</span><br><span class="line"><span class="number">26</span> </span><br><span class="line"><span class="number">27</span> <span class="class"><span class="keyword">class</span> <span class="title">MyThread</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line"><span class="number">28</span> </span><br><span class="line"><span class="number">29</span>     <span class="keyword">private</span> <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line"><span class="number">30</span>     </span><br><span class="line"><span class="number">31</span>     <span class="function"><span class="keyword">public</span> <span class="title">MyThread</span><span class="params">(Runnable runnable)</span></span>&#123;</span><br><span class="line"><span class="number">32</span>         <span class="keyword">super</span>(runnable);</span><br><span class="line"><span class="number">33</span>     &#125;</span><br><span class="line"><span class="number">34</span> </span><br><span class="line"><span class="number">35</span>     <span class="meta">@Override</span></span><br><span class="line"><span class="number">36</span>     <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="number">37</span>         System.out.println(<span class="string">"in MyThread run"</span>);</span><br><span class="line"><span class="number">38</span>         <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line"><span class="number">39</span>             System.out.println(Thread.currentThread().getName() + <span class="string">" "</span> + i);</span><br><span class="line"><span class="number">40</span>         &#125;</span><br><span class="line"><span class="number">41</span>     &#125;</span><br><span class="line"><span class="number">42</span> &#125;</span><br></pre></td></tr></table></figure>



<p>同样的，与实现Runnable接口创建线程方式相似，不同的地方在于</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> Thread thread = <span class="keyword">new</span> MyThread(myRunnable);</span><br></pre></td></tr></table></figure>



<p>那么这种方式可以顺利创建出一个新的线程么？答案是肯定的。至于此时的线程执行体到底是MyRunnable接口中的run()方法还是MyThread类中的run()方法呢？通过输出我们知道线程执行体是MyThread类中的run()方法。其实原因很简单，因为Thread类本身也是实现了Runnable接口，而run()方法最先是在Runnable接口中定义的方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> <span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line"><span class="number">2</span>    </span><br><span class="line"><span class="number">3</span>     <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>;</span><br><span class="line"><span class="number">4</span>     </span><br><span class="line"><span class="number">5</span> &#125;</span><br></pre></td></tr></table></figure>

<p>我们看一下Thread类中对Runnable接口中run()方法的实现：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">　　<span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (target != <span class="keyword">null</span>) &#123;</span><br><span class="line">        target.run();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>也就是说，当执行到Thread类中的run()方法时，会首先判断target是否存在，存在则执行target中的run()方法，也就是实现了Runnable接口并重写了run()方法的类中的run()方法。但是上述给到的列子中，由于多态的存在，根本就没有执行到Thread类中的run()方法，而是直接先执行了运行时类型即MyThread类中的run()方法。</p>
<p><strong>3.使用Callable和Future接口创建线程。具体是创建Callable接口的实现类，并实现clall()方法。并使用FutureTask类来包装Callable实现类的对象，且以此FutureTask对象作为Thread对象的target来创建线程。</strong></p>
<p> 看着好像有点复杂，直接来看一个例子就清晰了。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"> <span class="number">1</span> <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadTest</span> </span>&#123;</span><br><span class="line"> <span class="number">2</span> </span><br><span class="line"> <span class="number">3</span>     <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"> <span class="number">4</span> </span><br><span class="line"> <span class="number">5</span>         Callable&lt;Integer&gt; myCallable = <span class="keyword">new</span> MyCallable();    <span class="comment">// 创建MyCallable对象</span></span><br><span class="line"> <span class="number">6</span>         FutureTask&lt;Integer&gt; ft = <span class="keyword">new</span> FutureTask&lt;Integer&gt;(myCallable); <span class="comment">//使用FutureTask来包装MyCallable对象</span></span><br><span class="line"> <span class="number">7</span> </span><br><span class="line"> <span class="number">8</span>         <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line"> <span class="number">9</span>             System.out.println(Thread.currentThread().getName() + <span class="string">" "</span> + i);</span><br><span class="line"><span class="number">10</span>             <span class="keyword">if</span> (i == <span class="number">30</span>) &#123;</span><br><span class="line"><span class="number">11</span>                 Thread thread = <span class="keyword">new</span> Thread(ft);   <span class="comment">//FutureTask对象作为Thread对象的target创建新的线程</span></span><br><span class="line"><span class="number">12</span>                 thread.start();                      <span class="comment">//线程进入到就绪状态</span></span><br><span class="line"><span class="number">13</span>             &#125;</span><br><span class="line"><span class="number">14</span>         &#125;</span><br><span class="line"><span class="number">15</span> </span><br><span class="line"><span class="number">16</span>         System.out.println(<span class="string">"主线程for循环执行完毕.."</span>);</span><br><span class="line"><span class="number">17</span>         </span><br><span class="line"><span class="number">18</span>         <span class="keyword">try</span> &#123;</span><br><span class="line"><span class="number">19</span>             <span class="keyword">int</span> sum = ft.get();            <span class="comment">//取得新创建的新线程中的call()方法返回的结果</span></span><br><span class="line"><span class="number">20</span>             System.out.println(<span class="string">"sum = "</span> + sum);</span><br><span class="line"><span class="number">21</span>         &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line"><span class="number">22</span>             e.printStackTrace();</span><br><span class="line"><span class="number">23</span>         &#125; <span class="keyword">catch</span> (ExecutionException e) &#123;</span><br><span class="line"><span class="number">24</span>             e.printStackTrace();</span><br><span class="line"><span class="number">25</span>         &#125;</span><br><span class="line"><span class="number">26</span> </span><br><span class="line"><span class="number">27</span>     &#125;</span><br><span class="line"><span class="number">28</span> &#125;</span><br><span class="line"><span class="number">29</span> </span><br><span class="line"><span class="number">30</span> </span><br><span class="line"><span class="number">31</span> <span class="class"><span class="keyword">class</span> <span class="title">MyCallable</span> <span class="keyword">implements</span> <span class="title">Callable</span>&lt;<span class="title">Integer</span>&gt; </span>&#123;</span><br><span class="line"><span class="number">32</span>     <span class="keyword">private</span> <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line"><span class="number">33</span> </span><br><span class="line"><span class="number">34</span>     <span class="comment">// 与run()方法不同的是，call()方法具有返回值</span></span><br><span class="line"><span class="number">35</span>     <span class="meta">@Override</span></span><br><span class="line"><span class="number">36</span>     <span class="function"><span class="keyword">public</span> Integer <span class="title">call</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="number">37</span>         <span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line"><span class="number">38</span>         <span class="keyword">for</span> (; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line"><span class="number">39</span>             System.out.println(Thread.currentThread().getName() + <span class="string">" "</span> + i);</span><br><span class="line"><span class="number">40</span>             sum += i;</span><br><span class="line"><span class="number">41</span>         &#125;</span><br><span class="line"><span class="number">42</span>         <span class="keyword">return</span> sum;</span><br><span class="line"><span class="number">43</span>     &#125;</span><br><span class="line"><span class="number">44</span> </span><br><span class="line"><span class="number">45</span> &#125;</span><br></pre></td></tr></table></figure>



<p>首先，我们发现，在实现Callable接口中，此时不再是run()方法了，而是call()方法，此call()方法作为线程执行体，同时还具有返回值！在创建新的线程时，是通过FutureTask来包装MyCallable对象，同时作为了Thread对象的target。那么看下FutureTask类的定义：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FutureTask</span>&lt;<span class="title">V</span>&gt; <span class="keyword">implements</span> <span class="title">RunnableFuture</span>&lt;<span class="title">V</span>&gt; </span>&#123;</span><br><span class="line"><span class="number">2</span>     </span><br><span class="line"><span class="number">3</span>     <span class="comment">//....</span></span><br><span class="line"><span class="number">4</span>     </span><br><span class="line"><span class="number">5</span> &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> <span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">RunnableFuture</span>&lt;<span class="title">V</span>&gt; <span class="keyword">extends</span> <span class="title">Runnable</span>, <span class="title">Future</span>&lt;<span class="title">V</span>&gt; </span>&#123;</span><br><span class="line"><span class="number">2</span>     </span><br><span class="line"><span class="number">3</span>     <span class="function"><span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>;</span><br><span class="line"><span class="number">4</span>     </span><br><span class="line"><span class="number">5</span> &#125;</span><br></pre></td></tr></table></figure>



<p>于是，我们发现FutureTask类实际上是同时实现了Runnable和Future接口，由此才使得其具有Future和Runnable双重特性。通过Runnable特性，可以作为Thread对象的target，而Future特性，使得其可以取得新创建线程中的call()方法的返回值。</p>
<p>执行下此程序，我们发现sum = 4950永远都是最后输出的。而“主线程for循环执行完毕..”则很可能是在子线程循环中间输出。由CPU的线程调度机制，我们知道，“主线程for循环执行完毕..”的输出时机是没有任何问题的，那么为什么sum =4950会永远最后输出呢？</p>
<p>原因在于通过ft.get()方法获取子线程call()方法的返回值时，当子线程此方法还未执行完毕，ft.get()方法会一直阻塞，直到call()方法执行完毕才能取到返回值。</p>
<p>上述主要讲解了三种常见的线程创建方式，对于线程的启动而言，都是调用线程对象的start()方法，需要特别注意的是：<strong>不能对同一线程对象两次调用start()方法。</strong></p>
<p><strong>三. Java多线程的就绪、运行和死亡状态</strong></p>
<p>就绪状态转换为运行状态：当此线程得到处理器资源；</p>
<p>运行状态转换为就绪状态：当此线程主动调用yield()方法或在运行过程中失去处理器资源。</p>
<p>运行状态转换为死亡状态：当此线程线程执行体执行完毕或发生了异常。</p>
<p>此处需要特别注意的是：当调用线程的yield()方法时，线程从运行状态转换为就绪状态，但接下来CPU调度就绪状态中的哪个线程具有一定的随机性，因此，可能会出现A线程调用了yield()方法后，接下来CPU仍然调度了A线程的情况。</p>
<p>由于实际的业务需要，常常会遇到需要在特定时机终止某一线程的运行，使其进入到死亡状态。目前最通用的做法是设置一boolean型的变量，当条件满足时，使线程执行体快速执行完毕。如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"> <span class="number">1</span> <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadTest</span> </span>&#123;</span><br><span class="line"> <span class="number">2</span> </span><br><span class="line"> <span class="number">3</span>     <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"> <span class="number">4</span> </span><br><span class="line"> <span class="number">5</span>         MyRunnable myRunnable = <span class="keyword">new</span> MyRunnable();</span><br><span class="line"> <span class="number">6</span>         Thread thread = <span class="keyword">new</span> Thread(myRunnable);</span><br><span class="line"> <span class="number">7</span>         </span><br><span class="line"> <span class="number">8</span>         <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line"> <span class="number">9</span>             System.out.println(Thread.currentThread().getName() + <span class="string">" "</span> + i);</span><br><span class="line"><span class="number">10</span>             <span class="keyword">if</span> (i == <span class="number">30</span>) &#123;</span><br><span class="line"><span class="number">11</span>                 thread.start();</span><br><span class="line"><span class="number">12</span>             &#125;</span><br><span class="line"><span class="number">13</span>             <span class="keyword">if</span>(i == <span class="number">40</span>)&#123;</span><br><span class="line"><span class="number">14</span>                 myRunnable.stopThread();</span><br><span class="line"><span class="number">15</span>             &#125;</span><br><span class="line"><span class="number">16</span>         &#125;</span><br><span class="line"><span class="number">17</span>     &#125;</span><br><span class="line"><span class="number">18</span> &#125;</span><br><span class="line"><span class="number">19</span> </span><br><span class="line"><span class="number">20</span> <span class="class"><span class="keyword">class</span> <span class="title">MyRunnable</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line"><span class="number">21</span> </span><br><span class="line"><span class="number">22</span>     <span class="keyword">private</span> <span class="keyword">boolean</span> stop;</span><br><span class="line"><span class="number">23</span> </span><br><span class="line"><span class="number">24</span>     <span class="meta">@Override</span></span><br><span class="line"><span class="number">25</span>     <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="number">26</span>         <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span> &amp;&amp; !stop; i++) &#123;</span><br><span class="line"><span class="number">27</span>             System.out.println(Thread.currentThread().getName() + <span class="string">" "</span> + i);</span><br><span class="line"><span class="number">28</span>         &#125;</span><br><span class="line"><span class="number">29</span>     &#125;</span><br><span class="line"><span class="number">30</span> </span><br><span class="line"><span class="number">31</span>     <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">stopThread</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="number">32</span>         <span class="keyword">this</span>.stop = <span class="keyword">true</span>;</span><br><span class="line"><span class="number">33</span>     &#125;</span><br><span class="line"><span class="number">34</span> </span><br><span class="line"><span class="number">35</span> &#125;</span><br></pre></td></tr></table></figure>



<p><img src="/2020/07/02/second/Users/Administrator/AppData/Local/YNote/data/qq603F12696BD3B57EFA011C366B93AE8F/31c67ae1d2aa43ee82114a46fb9689b8/copycode.gif" alt="img"></p>
<p><a href="https://www.cnblogs.com/lwbqqyumidi/p/3817517.html" target="_blank" rel="noopener"><strong>Java总结篇系列：Java多线程（二）</strong></a></p>
<p>本文承接上一篇文章<a href="http://www.cnblogs.com/lwbqqyumidi/p/3804883.html" target="_blank" rel="noopener">《Java总结篇系列：Java多线程（一）》</a>。</p>
<p><strong>四.Java多线程的阻塞状态与线程控制</strong></p>
<p>上文已经提到Java阻塞的几种具体类型。下面分别看下引起Java线程阻塞的主要方法。</p>
<p><strong>1.join()</strong></p>
<p>join —— 让一个线程等待另一个线程完成才继续执行。如A线程线程执行体中调用B线程的join()方法，则A线程被阻塞，知道B线程执行完为止，A才能得以继续执行。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"> <span class="number">1</span> <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadTest</span> </span>&#123;</span><br><span class="line"> <span class="number">2</span> </span><br><span class="line"> <span class="number">3</span>     <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"> <span class="number">4</span> </span><br><span class="line"> <span class="number">5</span>         MyRunnable myRunnable = <span class="keyword">new</span> MyRunnable();</span><br><span class="line"> <span class="number">6</span>         Thread thread = <span class="keyword">new</span> Thread(myRunnable);</span><br><span class="line"> <span class="number">7</span> </span><br><span class="line"> <span class="number">8</span>         <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line"> <span class="number">9</span>             System.out.println(Thread.currentThread().getName() + <span class="string">" "</span> + i);</span><br><span class="line"><span class="number">10</span>             <span class="keyword">if</span> (i == <span class="number">30</span>) &#123;</span><br><span class="line"><span class="number">11</span>                 thread.start();</span><br><span class="line"><span class="number">12</span>                 <span class="keyword">try</span> &#123;</span><br><span class="line"><span class="number">13</span>                     thread.join();    <span class="comment">// main线程需要等待thread线程执行完后才能继续执行</span></span><br><span class="line"><span class="number">14</span>                 &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line"><span class="number">15</span>                     e.printStackTrace();</span><br><span class="line"><span class="number">16</span>                 &#125;</span><br><span class="line"><span class="number">17</span>             &#125;</span><br><span class="line"><span class="number">18</span>         &#125;</span><br><span class="line"><span class="number">19</span>     &#125;</span><br><span class="line"><span class="number">20</span> &#125;</span><br><span class="line"><span class="number">21</span> </span><br><span class="line"><span class="number">22</span> <span class="class"><span class="keyword">class</span> <span class="title">MyRunnable</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line"><span class="number">23</span> </span><br><span class="line"><span class="number">24</span>     <span class="meta">@Override</span></span><br><span class="line"><span class="number">25</span>     <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="number">26</span>         <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line"><span class="number">27</span>             System.out.println(Thread.currentThread().getName() + <span class="string">" "</span> + i);</span><br><span class="line"><span class="number">28</span>         &#125;</span><br><span class="line"><span class="number">29</span>     &#125;</span><br><span class="line"><span class="number">30</span> &#125;</span><br></pre></td></tr></table></figure>





<p><strong>2.sleep()</strong></p>
<p>sleep —— 让当前的正在执行的线程暂停指定的时间，并进入阻塞状态。在其睡眠的时间段内，该线程由于不是处于就绪状态，因此不会得到执行的机会。即使此时系统中没有任何其他可执行的线程，出于sleep()中的线程也不会执行。因此sleep()方法常用来暂停线程执行。</p>
<p>前面有讲到，当调用了新建的线程的start()方法后，线程进入到就绪状态，可能会在接下来的某个时间获取CPU时间片得以执行，如果希望这个新线程必然性的立即执行，直接调用原来线程的sleep(1)即可。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"> <span class="number">1</span> <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadTest</span> </span>&#123;</span><br><span class="line"> <span class="number">2</span> </span><br><span class="line"> <span class="number">3</span>     <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"> <span class="number">4</span> </span><br><span class="line"> <span class="number">5</span>         MyRunnable myRunnable = <span class="keyword">new</span> MyRunnable();</span><br><span class="line"> <span class="number">6</span>         Thread thread = <span class="keyword">new</span> Thread(myRunnable);</span><br><span class="line"> <span class="number">7</span> </span><br><span class="line"> <span class="number">8</span>         <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line"> <span class="number">9</span>             System.out.println(Thread.currentThread().getName() + <span class="string">" "</span> + i);</span><br><span class="line"><span class="number">10</span>             <span class="keyword">if</span> (i == <span class="number">30</span>) &#123;</span><br><span class="line"><span class="number">11</span>                 thread.start();</span><br><span class="line"><span class="number">12</span>                 <span class="keyword">try</span> &#123;</span><br><span class="line"><span class="number">13</span>                     Thread.sleep(<span class="number">1</span>);   <span class="comment">// 使得thread必然能够马上得以执行</span></span><br><span class="line"><span class="number">14</span>                 &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line"><span class="number">15</span>                     e.printStackTrace();</span><br><span class="line"><span class="number">16</span>                 &#125;</span><br><span class="line"><span class="number">17</span>             &#125;</span><br><span class="line"><span class="number">18</span>         &#125;</span><br><span class="line"><span class="number">19</span>     &#125;</span><br><span class="line"><span class="number">20</span> &#125;</span><br><span class="line"><span class="number">21</span> </span><br><span class="line"><span class="number">22</span> <span class="class"><span class="keyword">class</span> <span class="title">MyRunnable</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line"><span class="number">23</span> </span><br><span class="line"><span class="number">24</span>     <span class="meta">@Override</span></span><br><span class="line"><span class="number">25</span>     <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="number">26</span>         <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line"><span class="number">27</span>             System.out.println(Thread.currentThread().getName() + <span class="string">" "</span> + i);</span><br><span class="line"><span class="number">28</span>         &#125;</span><br><span class="line"><span class="number">29</span>     &#125;</span><br><span class="line"><span class="number">30</span> &#125;</span><br></pre></td></tr></table></figure>



<p>注：睡一个毫秒级够了，因为CPU不会空闲，会切换到新建的线程。</p>
<p><strong>3.后台线程（Daemon Thread）</strong></p>
<p>概念/目的：后台线程主要是为其他线程（相对可以称之为前台线程）提供服务，或“守护线程”。如JVM中的垃圾回收线程。</p>
<p>生命周期：后台线程的生命周期与前台线程生命周期有一定关联。主要体现在：当所有的前台线程都进入死亡状态时，后台线程会自动死亡(其实这个也很好理解，因为后台线程存在的目的在于为前台线程服务的，既然所有的前台线程都死亡了，那它自己还留着有什么用…伟大啊 ! !)。</p>
<p>设置后台线程：调用Thread对象的setDaemon(true)方法可以将指定的线程设置为后台线程。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"> <span class="number">1</span> <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadTest</span> </span>&#123;</span><br><span class="line"> <span class="number">2</span> </span><br><span class="line"> <span class="number">3</span>     <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"> <span class="number">4</span>         Thread myThread = <span class="keyword">new</span> MyThread();</span><br><span class="line"> <span class="number">5</span>         <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line"> <span class="number">6</span>             System.out.println(<span class="string">"main thread i = "</span> + i);</span><br><span class="line"> <span class="number">7</span>             <span class="keyword">if</span> (i == <span class="number">20</span>) &#123;</span><br><span class="line"> <span class="number">8</span>                 myThread.setDaemon(<span class="keyword">true</span>);</span><br><span class="line"> <span class="number">9</span>                 myThread.start();</span><br><span class="line"><span class="number">10</span>             &#125;</span><br><span class="line"><span class="number">11</span>         &#125;</span><br><span class="line"><span class="number">12</span>     &#125;</span><br><span class="line"><span class="number">13</span> </span><br><span class="line"><span class="number">14</span> &#125;</span><br><span class="line"><span class="number">15</span> </span><br><span class="line"><span class="number">16</span> <span class="class"><span class="keyword">class</span> <span class="title">MyThread</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line"><span class="number">17</span> </span><br><span class="line"><span class="number">18</span>     <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="number">19</span>         <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line"><span class="number">20</span>             System.out.println(<span class="string">"i = "</span> + i);</span><br><span class="line"><span class="number">21</span>             <span class="keyword">try</span> &#123;</span><br><span class="line"><span class="number">22</span>                 Thread.sleep(<span class="number">1</span>);</span><br><span class="line"><span class="number">23</span>             &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line"><span class="number">24</span>                 <span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line"><span class="number">25</span>                 e.printStackTrace();</span><br><span class="line"><span class="number">26</span>             &#125;</span><br><span class="line"><span class="number">27</span>         &#125;</span><br><span class="line"><span class="number">28</span>     &#125;</span><br><span class="line"><span class="number">29</span> &#125;</span><br></pre></td></tr></table></figure>



<p>判断线程是否是后台线程：调用thread对象的isDeamon()方法。</p>
<p>注：main线程默认是前台线程，前台线程创建中创建的子线程默认是前台线程，后台线程中创建的线程默认是后台线程。调用setDeamon(true)方法将前台线程设置为后台线程时，需要在start()方法调用之前。前天线程都死亡后，JVM通知后台线程死亡，但从接收指令到作出响应，需要一定的时间。</p>
<p><strong>4.改变线程的优先级/setPriority()：</strong></p>
<p>每个线程在执行时都具有一定的优先级，优先级高的线程具有较多的执行机会。每个线程默认的优先级都与创建它的线程的优先级相同。main线程默认具有普通优先级。</p>
<p>设置线程优先级：setPriority(int priorityLevel)。参数priorityLevel范围在1-10之间，常用的有如下三个静态常量值：</p>
<p>MAX_PRIORITY:10</p>
<p>MIN_PRIORITY:1</p>
<p>NORM_PRIORITY:5</p>
<p>获取线程优先级：getPriority()。</p>
<p><strong>注：具有较高线程优先级的线程对象仅表示此线程具有较多的执行机会，而非优先执行。</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"> <span class="number">1</span> <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadTest</span> </span>&#123;</span><br><span class="line"> <span class="number">2</span> </span><br><span class="line"> <span class="number">3</span>     <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"> <span class="number">4</span>         Thread myThread = <span class="keyword">new</span> MyThread();</span><br><span class="line"> <span class="number">5</span>         <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line"> <span class="number">6</span>             System.out.println(<span class="string">"main thread i = "</span> + i);</span><br><span class="line"> <span class="number">7</span>             <span class="keyword">if</span> (i == <span class="number">20</span>) &#123;</span><br><span class="line"> <span class="number">8</span>                 myThread.setPriority(Thread.MAX_PRIORITY);</span><br><span class="line"> <span class="number">9</span>                 myThread.start();</span><br><span class="line"><span class="number">10</span>             &#125;</span><br><span class="line"><span class="number">11</span>         &#125;</span><br><span class="line"><span class="number">12</span>     &#125;</span><br><span class="line"><span class="number">13</span> </span><br><span class="line"><span class="number">14</span> &#125;</span><br><span class="line"><span class="number">15</span> </span><br><span class="line"><span class="number">16</span> <span class="class"><span class="keyword">class</span> <span class="title">MyThread</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line"><span class="number">17</span> </span><br><span class="line"><span class="number">18</span>     <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="number">19</span>         <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line"><span class="number">20</span>             System.out.println(<span class="string">"i = "</span> + i);</span><br><span class="line"><span class="number">21</span>         &#125;</span><br><span class="line"><span class="number">22</span>     &#125;</span><br><span class="line"><span class="number">23</span> &#125;</span><br></pre></td></tr></table></figure>





<p><strong>5.线程让步：yield()</strong></p>
<p>上一篇博文中已经讲到了yield()的基本作用，同时，yield()方法还与线程优先级有关，当某个线程调用yiled()方法从运行状态转换到就绪状态后，CPU从就绪状态线程队列中只会选择与该线程优先级相同或优先级更高的线程去执行。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"> <span class="number">1</span> <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadTest</span> </span>&#123;</span><br><span class="line"> <span class="number">2</span> </span><br><span class="line"> <span class="number">3</span>     <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"> <span class="number">4</span>         Thread myThread1 = <span class="keyword">new</span> MyThread1();</span><br><span class="line"> <span class="number">5</span>         Thread myThread2 = <span class="keyword">new</span> MyThread2();</span><br><span class="line"> <span class="number">6</span>         myThread1.setPriority(Thread.MAX_PRIORITY);</span><br><span class="line"> <span class="number">7</span>         myThread2.setPriority(Thread.MIN_PRIORITY);</span><br><span class="line"> <span class="number">8</span>         <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line"> <span class="number">9</span>             System.out.println(<span class="string">"main thread i = "</span> + i);</span><br><span class="line"><span class="number">10</span>             <span class="keyword">if</span> (i == <span class="number">20</span>) &#123;</span><br><span class="line"><span class="number">11</span>                 myThread1.start();</span><br><span class="line"><span class="number">12</span>                 myThread2.start();</span><br><span class="line"><span class="number">13</span>                 Thread.yield();</span><br><span class="line"><span class="number">14</span>             &#125;</span><br><span class="line"><span class="number">15</span>         &#125;</span><br><span class="line"><span class="number">16</span>     &#125;</span><br><span class="line"><span class="number">17</span> </span><br><span class="line"><span class="number">18</span> &#125;</span><br><span class="line"><span class="number">19</span> </span><br><span class="line"><span class="number">20</span> <span class="class"><span class="keyword">class</span> <span class="title">MyThread1</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line"><span class="number">21</span> </span><br><span class="line"><span class="number">22</span>     <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="number">23</span>         <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line"><span class="number">24</span>             System.out.println(<span class="string">"myThread 1 --  i = "</span> + i);</span><br><span class="line"><span class="number">25</span>         &#125;</span><br><span class="line"><span class="number">26</span>     &#125;</span><br><span class="line"><span class="number">27</span> &#125;</span><br><span class="line"><span class="number">28</span> </span><br><span class="line"><span class="number">29</span> <span class="class"><span class="keyword">class</span> <span class="title">MyThread2</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line"><span class="number">30</span> </span><br><span class="line"><span class="number">31</span>     <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="number">32</span>         <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line"><span class="number">33</span>             System.out.println(<span class="string">"myThread 2 --  i = "</span> + i);</span><br><span class="line"><span class="number">34</span>         &#125;</span><br><span class="line"><span class="number">35</span>     &#125;</span><br><span class="line"><span class="number">36</span> &#125;</span><br></pre></td></tr></table></figure>



<p><a href="https://www.cnblogs.com/lwbqqyumidi/p/3821389.html" target="_blank" rel="noopener"><strong>Java总结篇系列：Java多线程（三）</strong></a></p>
<p>本文主要接着前面多线程的两篇文章总结Java多线程中的线程安全问题。</p>
<p><strong>一.一个典型的Java线程安全例子</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"> <span class="number">1</span> <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadTest</span> </span>&#123;</span><br><span class="line"> <span class="number">2</span> </span><br><span class="line"> <span class="number">3</span>     <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"> <span class="number">4</span>         Account account = <span class="keyword">new</span> Account(<span class="string">"123456"</span>, <span class="number">1000</span>);</span><br><span class="line"> <span class="number">5</span>         DrawMoneyRunnable drawMoneyRunnable = <span class="keyword">new</span> DrawMoneyRunnable(account, <span class="number">700</span>);</span><br><span class="line"> <span class="number">6</span>         Thread myThread1 = <span class="keyword">new</span> Thread(drawMoneyRunnable);</span><br><span class="line"> <span class="number">7</span>         Thread myThread2 = <span class="keyword">new</span> Thread(drawMoneyRunnable);</span><br><span class="line"> <span class="number">8</span>         myThread1.start();</span><br><span class="line"> <span class="number">9</span>         myThread2.start();</span><br><span class="line"><span class="number">10</span>     &#125;</span><br><span class="line"><span class="number">11</span> </span><br><span class="line"><span class="number">12</span> &#125;</span><br><span class="line"><span class="number">13</span> </span><br><span class="line"><span class="number">14</span> <span class="class"><span class="keyword">class</span> <span class="title">DrawMoneyRunnable</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line"><span class="number">15</span> </span><br><span class="line"><span class="number">16</span>     <span class="keyword">private</span> Account account;</span><br><span class="line"><span class="number">17</span>     <span class="keyword">private</span> <span class="keyword">double</span> drawAmount;</span><br><span class="line"><span class="number">18</span> </span><br><span class="line"><span class="number">19</span>     <span class="function"><span class="keyword">public</span> <span class="title">DrawMoneyRunnable</span><span class="params">(Account account, <span class="keyword">double</span> drawAmount)</span> </span>&#123;</span><br><span class="line"><span class="number">20</span>         <span class="keyword">super</span>();</span><br><span class="line"><span class="number">21</span>         <span class="keyword">this</span>.account = account;</span><br><span class="line"><span class="number">22</span>         <span class="keyword">this</span>.drawAmount = drawAmount;</span><br><span class="line"><span class="number">23</span>     &#125;</span><br><span class="line"><span class="number">24</span> </span><br><span class="line"><span class="number">25</span>     <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="number">26</span>         <span class="keyword">if</span> (account.getBalance() &gt;= drawAmount) &#123;  <span class="comment">//1</span></span><br><span class="line"><span class="number">27</span>             System.out.println(<span class="string">"取钱成功， 取出钱数为："</span> + drawAmount);</span><br><span class="line"><span class="number">28</span>             <span class="keyword">double</span> balance = account.getBalance() - drawAmount;</span><br><span class="line"><span class="number">29</span>             account.setBalance(balance);</span><br><span class="line"><span class="number">30</span>             System.out.println(<span class="string">"余额为："</span> + balance);</span><br><span class="line"><span class="number">31</span>         &#125;</span><br><span class="line"><span class="number">32</span>     &#125;</span><br><span class="line"><span class="number">33</span> &#125;</span><br><span class="line"><span class="number">34</span> </span><br><span class="line"><span class="number">35</span> <span class="class"><span class="keyword">class</span> <span class="title">Account</span> </span>&#123;</span><br><span class="line"><span class="number">36</span> </span><br><span class="line"><span class="number">37</span>     <span class="keyword">private</span> String accountNo;</span><br><span class="line"><span class="number">38</span>     <span class="keyword">private</span> <span class="keyword">double</span> balance;</span><br><span class="line"><span class="number">39</span> </span><br><span class="line"><span class="number">40</span>     <span class="function"><span class="keyword">public</span> <span class="title">Account</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="number">41</span> </span><br><span class="line"><span class="number">42</span>     &#125;</span><br><span class="line"><span class="number">43</span> </span><br><span class="line"><span class="number">44</span>     <span class="function"><span class="keyword">public</span> <span class="title">Account</span><span class="params">(String accountNo, <span class="keyword">double</span> balance)</span> </span>&#123;</span><br><span class="line"><span class="number">45</span>         <span class="keyword">this</span>.accountNo = accountNo;</span><br><span class="line"><span class="number">46</span>         <span class="keyword">this</span>.balance = balance;</span><br><span class="line"><span class="number">47</span>     &#125;</span><br><span class="line"><span class="number">48</span> </span><br><span class="line"><span class="number">49</span>     <span class="function"><span class="keyword">public</span> String <span class="title">getAccountNo</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="number">50</span>         <span class="keyword">return</span> accountNo;</span><br><span class="line"><span class="number">51</span>     &#125;</span><br><span class="line"><span class="number">52</span> </span><br><span class="line"><span class="number">53</span>     <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAccountNo</span><span class="params">(String accountNo)</span> </span>&#123;</span><br><span class="line"><span class="number">54</span>         <span class="keyword">this</span>.accountNo = accountNo;</span><br><span class="line"><span class="number">55</span>     &#125;</span><br><span class="line"><span class="number">56</span> </span><br><span class="line"><span class="number">57</span>     <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">getBalance</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="number">58</span>         <span class="keyword">return</span> balance;</span><br><span class="line"><span class="number">59</span>     &#125;</span><br><span class="line"><span class="number">60</span> </span><br><span class="line"><span class="number">61</span>     <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBalance</span><span class="params">(<span class="keyword">double</span> balance)</span> </span>&#123;</span><br><span class="line"><span class="number">62</span>         <span class="keyword">this</span>.balance = balance;</span><br><span class="line"><span class="number">63</span>     &#125;</span><br><span class="line"><span class="number">64</span> </span><br><span class="line"><span class="number">65</span> &#125;</span><br></pre></td></tr></table></figure>



<p>上面例子很容易理解，有一张银行卡，里面有1000的余额，程序模拟你和你老婆同时在取款机进行取钱操作的场景。多次运行此程序，可能具有多个不同组合的输出结果。其中一种可能的输出为：</p>
<p>1 取钱成功， 取出钱数为：700.0 2 余额为：300.0 3 取钱成功， 取出钱数为：700.0 4 余额为：-400.0</p>
<p>也就是说，对于一张只有1000余额的银行卡，你们一共可以取出1400，这显然是有问题的。</p>
<p>经过分析，问题在于Java多线程环境下的执行的不确定性。CPU可能随机的在多个处于就绪状态中的线程中进行切换，因此，很有可能出现如下情况：当thread1执行到//1处代码时，判断条件为true，此时CPU切换到thread2，执行//1处代码，发现依然为真，然后执行完thread2，接着切换到thread1，接着执行完毕。此时，就会出现上述结果。</p>
<p>因此，讲到线程安全问题，其实是指多线程环境下对共享资源的访问可能会引起此共享资源的不一致性。因此，为避免线程安全问题，应该避免多线程环境下对此共享资源的并发访问。</p>
<p><strong>二.同步方法</strong></p>
<p>对共享资源进行访问的方法定义中加上synchronized关键字修饰，使得此方法称为同步方法。可以简单理解成对此方法进行了加锁，其锁对象为当前方法所在的对象自身。多线程环境下，当执行此方法时，首先都要获得此同步锁（且同时最多只有一个线程能够获得），只有当线程执行完此同步方法后，才会释放锁对象，其他的线程才有可能获取此同步锁，以此类推…</p>
<p>在上例中，共享资源为account对象，当使用同步方法时，可以解决线程安全问题。只需在run()方法前加上synshronized关键字即可。</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="number">2</span>        </span><br><span class="line"><span class="number">3</span>     <span class="comment">// ....</span></span><br><span class="line"><span class="number">4</span>  </span><br><span class="line"><span class="number">5</span> &#125;</span><br></pre></td></tr></table></figure>



<p><strong>三.同步代码块</strong></p>
<p>正如上面所分析的那样，解决线程安全问题其实只需限制对共享资源访问的不确定性即可。使用同步方法时，使得整个方法体都成为了同步执行状态，会使得可能出现同步范围过大的情况，于是，针对需要同步的代码可以直接另一种同步方式——同步代码块来解决。</p>
<p>同步代码块的格式为：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> <span class="keyword">synchronized</span> (obj) &#123;</span><br><span class="line"><span class="number">2</span>             </span><br><span class="line"><span class="number">3</span>     <span class="comment">//...</span></span><br><span class="line"><span class="number">4</span> </span><br><span class="line"><span class="number">5</span> &#125;</span><br></pre></td></tr></table></figure>



<p><strong>其中，obj为锁对象，因此，选择哪一个对象作为锁是至关重要的。一般情况下，都是选择此共享资源对象作为锁对象。</strong></p>
<p><strong>如上例中，最好选用account对象作为锁对象。（当然，选用this也是可以的，那是因为创建线程使用了runnable方式，如果是直接继承Thread方式创建的线程，使用this对象作为同步锁会其实没有起到任何作用，因为是不同的对象了。因此，选择同步锁时需要格外小心…）</strong></p>
<p><strong>四.Lock对象同步锁</strong></p>
<p>上面我们可以看出，正因为对同步锁对象的选择需要如此小心，有没有什么简单点的解决方案呢？以方便同步锁对象与共享资源解耦，同时又能很好的解决线程安全问题。</p>
<p>使用Lock对象同步锁可以方便的解决此问题，唯一需要注意的一点是Lock对象需要与资源对象同样具有一对一的关系。Lock对象同步锁一般格式为：</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"> <span class="number">1</span>   <span class="class"><span class="keyword">class</span> <span class="title">X</span> </span>&#123;</span><br><span class="line"> <span class="number">2</span>     </span><br><span class="line"> <span class="number">3</span>     <span class="comment">// 显示定义Lock同步锁对象，此对象与共享资源具有一对一关系</span></span><br><span class="line"> <span class="number">4</span>     <span class="keyword">private</span> <span class="keyword">final</span> Lock lock = <span class="keyword">new</span> ReentrantLock();</span><br><span class="line"> <span class="number">5</span>     </span><br><span class="line"> <span class="number">6</span>     <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">m</span><span class="params">()</span></span>&#123;</span><br><span class="line"> <span class="number">7</span>         <span class="comment">// 加锁</span></span><br><span class="line"> <span class="number">8</span>         lock.lock();</span><br><span class="line"> <span class="number">9</span>         </span><br><span class="line"><span class="number">10</span>         <span class="comment">//...  需要进行线程安全同步的代码</span></span><br><span class="line"><span class="number">11</span>         </span><br><span class="line"><span class="number">12</span>         <span class="comment">// 释放Lock锁</span></span><br><span class="line"><span class="number">13</span>         lock.unlock();</span><br><span class="line"><span class="number">14</span>     &#125;</span><br><span class="line"><span class="number">15</span>     </span><br><span class="line"><span class="number">16</span> &#125;</span><br></pre></td></tr></table></figure>



<p> <strong>五.wait()/notify()/notifyAll()线程通信</strong></p>
<p>在博文<a href="http://www.cnblogs.com/lwbqqyumidi/p/3693015.html" target="_blank" rel="noopener">《Java总结篇系列：java.lang.Object》</a>中有提及到这三个方法，虽然这三个方法主要都是用于多线程中，但实际上都是Object类中的本地方法。因此，理论上，任何Object对象都可以作为这三个方法的主调，在实际的多线程编程中，只有同步锁对象调这三个方法，才能完成对多线程间的线程通信。</p>
<p>wait()：导致当前线程等待并使其进入到等待阻塞状态。直到其他线程调用该同步锁对象的notify()或notifyAll()方法来唤醒此线程。</p>
<p>notify()：唤醒在此同步锁对象上等待的单个线程，如果有多个线程都在此同步锁对象上等待，则会任意选择其中某个线程进行唤醒操作，只有当前线程放弃对同步锁对象的锁定，才可能执行被唤醒的线程。</p>
<p>notifyAll()：唤醒在此同步锁对象上等待的所有线程，只有当前线程放弃对同步锁对象的锁定，才可能执行被唤醒的线程。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br></pre></td><td class="code"><pre><span class="line"> <span class="number">1</span> <span class="keyword">package</span> com.qqyumidi;</span><br><span class="line">  <span class="number">2</span> </span><br><span class="line">  <span class="number">3</span> <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadTest</span> </span>&#123;</span><br><span class="line">  <span class="number">4</span> </span><br><span class="line">  <span class="number">5</span>     <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">  <span class="number">6</span>         Account account = <span class="keyword">new</span> Account(<span class="string">"123456"</span>, <span class="number">0</span>);</span><br><span class="line">  <span class="number">7</span> </span><br><span class="line">  <span class="number">8</span>         Thread drawMoneyThread = <span class="keyword">new</span> DrawMoneyThread(<span class="string">"取钱线程"</span>, account, <span class="number">700</span>);</span><br><span class="line">  <span class="number">9</span>         Thread depositeMoneyThread = <span class="keyword">new</span> DepositeMoneyThread(<span class="string">"存钱线程"</span>, account, <span class="number">700</span>);</span><br><span class="line"> <span class="number">10</span> </span><br><span class="line"> <span class="number">11</span>         drawMoneyThread.start();</span><br><span class="line"> <span class="number">12</span>         depositeMoneyThread.start();</span><br><span class="line"> <span class="number">13</span>     &#125;</span><br><span class="line"> <span class="number">14</span> </span><br><span class="line"> <span class="number">15</span> &#125;</span><br><span class="line"> <span class="number">16</span> </span><br><span class="line"> <span class="number">17</span> <span class="class"><span class="keyword">class</span> <span class="title">DrawMoneyThread</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line"> <span class="number">18</span> </span><br><span class="line"> <span class="number">19</span>     <span class="keyword">private</span> Account account;</span><br><span class="line"> <span class="number">20</span>     <span class="keyword">private</span> <span class="keyword">double</span> amount;</span><br><span class="line"> <span class="number">21</span> </span><br><span class="line"> <span class="number">22</span>     <span class="function"><span class="keyword">public</span> <span class="title">DrawMoneyThread</span><span class="params">(String threadName, Account account, <span class="keyword">double</span> amount)</span> </span>&#123;</span><br><span class="line"> <span class="number">23</span>         <span class="keyword">super</span>(threadName);</span><br><span class="line"> <span class="number">24</span>         <span class="keyword">this</span>.account = account;</span><br><span class="line"> <span class="number">25</span>         <span class="keyword">this</span>.amount = amount;</span><br><span class="line"> <span class="number">26</span>     &#125;</span><br><span class="line"> <span class="number">27</span> </span><br><span class="line"> <span class="number">28</span>     <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line"> <span class="number">29</span>         <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line"> <span class="number">30</span>             account.draw(amount, i);</span><br><span class="line"> <span class="number">31</span>         &#125;</span><br><span class="line"> <span class="number">32</span>     &#125;</span><br><span class="line"> <span class="number">33</span> &#125;</span><br><span class="line"> <span class="number">34</span> </span><br><span class="line"> <span class="number">35</span> <span class="class"><span class="keyword">class</span> <span class="title">DepositeMoneyThread</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line"> <span class="number">36</span> </span><br><span class="line"> <span class="number">37</span>     <span class="keyword">private</span> Account account;</span><br><span class="line"> <span class="number">38</span>     <span class="keyword">private</span> <span class="keyword">double</span> amount;</span><br><span class="line"> <span class="number">39</span> </span><br><span class="line"> <span class="number">40</span>     <span class="function"><span class="keyword">public</span> <span class="title">DepositeMoneyThread</span><span class="params">(String threadName, Account account, <span class="keyword">double</span> amount)</span> </span>&#123;</span><br><span class="line"> <span class="number">41</span>         <span class="keyword">super</span>(threadName);</span><br><span class="line"> <span class="number">42</span>         <span class="keyword">this</span>.account = account;</span><br><span class="line"> <span class="number">43</span>         <span class="keyword">this</span>.amount = amount;</span><br><span class="line"> <span class="number">44</span>     &#125;</span><br><span class="line"> <span class="number">45</span> </span><br><span class="line"> <span class="number">46</span>     <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line"> <span class="number">47</span>         <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line"> <span class="number">48</span>             account.deposite(amount, i);</span><br><span class="line"> <span class="number">49</span>         &#125;</span><br><span class="line"> <span class="number">50</span>     &#125;</span><br><span class="line"> <span class="number">51</span> &#125;</span><br><span class="line"> <span class="number">52</span> </span><br><span class="line"> <span class="number">53</span> <span class="class"><span class="keyword">class</span> <span class="title">Account</span> </span>&#123;</span><br><span class="line"> <span class="number">54</span> </span><br><span class="line"> <span class="number">55</span>     <span class="keyword">private</span> String accountNo;</span><br><span class="line"> <span class="number">56</span>     <span class="keyword">private</span> <span class="keyword">double</span> balance;</span><br><span class="line"> <span class="number">57</span>     <span class="comment">// 标识账户中是否已有存款</span></span><br><span class="line"> <span class="number">58</span>     <span class="keyword">private</span> <span class="keyword">boolean</span> flag = <span class="keyword">false</span>;</span><br><span class="line"> <span class="number">59</span> </span><br><span class="line"> <span class="number">60</span>     <span class="function"><span class="keyword">public</span> <span class="title">Account</span><span class="params">()</span> </span>&#123;</span><br><span class="line"> <span class="number">61</span> </span><br><span class="line"> <span class="number">62</span>     &#125;</span><br><span class="line"> <span class="number">63</span> </span><br><span class="line"> <span class="number">64</span>     <span class="function"><span class="keyword">public</span> <span class="title">Account</span><span class="params">(String accountNo, <span class="keyword">double</span> balance)</span> </span>&#123;</span><br><span class="line"> <span class="number">65</span>         <span class="keyword">this</span>.accountNo = accountNo;</span><br><span class="line"> <span class="number">66</span>         <span class="keyword">this</span>.balance = balance;</span><br><span class="line"> <span class="number">67</span>     &#125;</span><br><span class="line"> <span class="number">68</span> </span><br><span class="line"> <span class="number">69</span>     <span class="function"><span class="keyword">public</span> String <span class="title">getAccountNo</span><span class="params">()</span> </span>&#123;</span><br><span class="line"> <span class="number">70</span>         <span class="keyword">return</span> accountNo;</span><br><span class="line"> <span class="number">71</span>     &#125;</span><br><span class="line"> <span class="number">72</span> </span><br><span class="line"> <span class="number">73</span>     <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAccountNo</span><span class="params">(String accountNo)</span> </span>&#123;</span><br><span class="line"> <span class="number">74</span>         <span class="keyword">this</span>.accountNo = accountNo;</span><br><span class="line"> <span class="number">75</span>     &#125;</span><br><span class="line"> <span class="number">76</span> </span><br><span class="line"> <span class="number">77</span>     <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">getBalance</span><span class="params">()</span> </span>&#123;</span><br><span class="line"> <span class="number">78</span>         <span class="keyword">return</span> balance;</span><br><span class="line"> <span class="number">79</span>     &#125;</span><br><span class="line"> <span class="number">80</span> </span><br><span class="line"> <span class="number">81</span>     <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBalance</span><span class="params">(<span class="keyword">double</span> balance)</span> </span>&#123;</span><br><span class="line"> <span class="number">82</span>         <span class="keyword">this</span>.balance = balance;</span><br><span class="line"> <span class="number">83</span>     &#125;</span><br><span class="line"> <span class="number">84</span> </span><br><span class="line"> <span class="number">85</span>     <span class="comment">/**</span></span><br><span class="line"><span class="comment"> 86      * 存钱</span></span><br><span class="line"><span class="comment"> 87      * </span></span><br><span class="line"><span class="comment"> 88      * <span class="doctag">@param</span> depositeAmount</span></span><br><span class="line"><span class="comment"> 89      */</span></span><br><span class="line"> <span class="number">90</span>     <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">deposite</span><span class="params">(<span class="keyword">double</span> depositeAmount, <span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line"> <span class="number">91</span> </span><br><span class="line"> <span class="number">92</span>         <span class="keyword">if</span> (flag) &#123;</span><br><span class="line"> <span class="number">93</span>             <span class="comment">// 账户中已有人存钱进去，此时当前线程需要等待阻塞</span></span><br><span class="line"> <span class="number">94</span>             <span class="keyword">try</span> &#123;</span><br><span class="line"> <span class="number">95</span>                 System.out.println(Thread.currentThread().getName() + <span class="string">" 开始要执行wait操作"</span> + <span class="string">" -- i="</span> + i);</span><br><span class="line"> <span class="number">96</span>                 wait();</span><br><span class="line"> <span class="number">97</span>                 <span class="comment">// 1</span></span><br><span class="line"> <span class="number">98</span>                 System.out.println(Thread.currentThread().getName() + <span class="string">" 执行了wait操作"</span> + <span class="string">" -- i="</span> + i);</span><br><span class="line"> <span class="number">99</span>             &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line"><span class="number">100</span>                 e.printStackTrace();</span><br><span class="line"><span class="number">101</span>             &#125;</span><br><span class="line"><span class="number">102</span>         &#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="number">103</span>             <span class="comment">// 开始存钱</span></span><br><span class="line"><span class="number">104</span>             System.out.println(Thread.currentThread().getName() + <span class="string">" 存款:"</span> + depositeAmount + <span class="string">" -- i="</span> + i);</span><br><span class="line"><span class="number">105</span>             setBalance(balance + depositeAmount);</span><br><span class="line"><span class="number">106</span>             flag = <span class="keyword">true</span>;</span><br><span class="line"><span class="number">107</span> </span><br><span class="line"><span class="number">108</span>             <span class="comment">// 唤醒其他线程</span></span><br><span class="line"><span class="number">109</span>             notifyAll();</span><br><span class="line"><span class="number">110</span> </span><br><span class="line"><span class="number">111</span>             <span class="comment">// 2</span></span><br><span class="line"><span class="number">112</span>             <span class="keyword">try</span> &#123;</span><br><span class="line"><span class="number">113</span>                 Thread.sleep(<span class="number">3000</span>);</span><br><span class="line"><span class="number">114</span>             &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line"><span class="number">115</span>                 e.printStackTrace();</span><br><span class="line"><span class="number">116</span>             &#125;</span><br><span class="line"><span class="number">117</span>             System.out.println(Thread.currentThread().getName() + <span class="string">"-- 存钱 -- 执行完毕"</span> + <span class="string">" -- i="</span> + i);</span><br><span class="line"><span class="number">118</span>         &#125;</span><br><span class="line"><span class="number">119</span>     &#125;</span><br><span class="line"><span class="number">120</span> </span><br><span class="line"><span class="number">121</span>     <span class="comment">/**</span></span><br><span class="line"><span class="comment">122      * 取钱</span></span><br><span class="line"><span class="comment">123      * </span></span><br><span class="line"><span class="comment">124      * <span class="doctag">@param</span> drawAmount</span></span><br><span class="line"><span class="comment">125      */</span></span><br><span class="line"><span class="number">126</span>     <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">draw</span><span class="params">(<span class="keyword">double</span> drawAmount, <span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line"><span class="number">127</span>         <span class="keyword">if</span> (!flag) &#123;</span><br><span class="line"><span class="number">128</span>             <span class="comment">// 账户中还没人存钱进去，此时当前线程需要等待阻塞</span></span><br><span class="line"><span class="number">129</span>             <span class="keyword">try</span> &#123;</span><br><span class="line"><span class="number">130</span>                 System.out.println(Thread.currentThread().getName() + <span class="string">" 开始要执行wait操作"</span> + <span class="string">" 执行了wait操作"</span> + <span class="string">" -- i="</span> + i);</span><br><span class="line"><span class="number">131</span>                 wait();</span><br><span class="line"><span class="number">132</span>                 System.out.println(Thread.currentThread().getName() + <span class="string">" 执行了wait操作"</span> + <span class="string">" 执行了wait操作"</span> + <span class="string">" -- i="</span> + i);</span><br><span class="line"><span class="number">133</span>             &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line"><span class="number">134</span>                 e.printStackTrace();</span><br><span class="line"><span class="number">135</span>             &#125;</span><br><span class="line"><span class="number">136</span>         &#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="number">137</span>             <span class="comment">// 开始取钱</span></span><br><span class="line"><span class="number">138</span>             System.out.println(Thread.currentThread().getName() + <span class="string">" 取钱："</span> + drawAmount + <span class="string">" -- i="</span> + i);</span><br><span class="line"><span class="number">139</span>             setBalance(getBalance() - drawAmount);</span><br><span class="line"><span class="number">140</span> </span><br><span class="line"><span class="number">141</span>             flag = <span class="keyword">false</span>;</span><br><span class="line"><span class="number">142</span> </span><br><span class="line"><span class="number">143</span>             <span class="comment">// 唤醒其他线程</span></span><br><span class="line"><span class="number">144</span>             notifyAll();</span><br><span class="line"><span class="number">145</span> </span><br><span class="line"><span class="number">146</span>             System.out.println(Thread.currentThread().getName() + <span class="string">"-- 取钱 -- 执行完毕"</span> + <span class="string">" -- i="</span> + i); <span class="comment">// 3</span></span><br><span class="line"><span class="number">147</span>         &#125;</span><br><span class="line"><span class="number">148</span>     &#125;</span><br><span class="line"><span class="number">149</span> </span><br><span class="line"><span class="number">150</span> &#125;</span><br></pre></td></tr></table></figure>



<p>上面的例子演示了wait()/notify()/notifyAll()的用法。部分输出结果为：</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"> <span class="number">1</span> 取钱线程 开始要执行<span class="keyword">wait</span>操作 执行了<span class="keyword">wait</span>操作 -- i=<span class="number">0</span></span><br><span class="line"> <span class="number">2</span> 存钱线程 存款:<span class="number">700</span><span class="variable">.0</span> -- i=<span class="number">0</span></span><br><span class="line"> <span class="number">3</span> 存钱线程-- 存钱 -- 执行完毕 -- i=<span class="number">0</span></span><br><span class="line"> <span class="number">4</span> 存钱线程 开始要执行<span class="keyword">wait</span>操作 -- i=<span class="number">1</span></span><br><span class="line"> <span class="number">5</span> 取钱线程 执行了<span class="keyword">wait</span>操作 执行了<span class="keyword">wait</span>操作 -- i=<span class="number">0</span></span><br><span class="line"> <span class="number">6</span> 取钱线程 取钱：<span class="number">700</span><span class="variable">.0</span> -- i=<span class="number">1</span></span><br><span class="line"> <span class="number">7</span> 取钱线程-- 取钱 -- 执行完毕 -- i=<span class="number">1</span></span><br><span class="line"> <span class="number">8</span> 取钱线程 开始要执行<span class="keyword">wait</span>操作 执行了<span class="keyword">wait</span>操作 -- i=<span class="number">2</span></span><br><span class="line"> <span class="number">9</span> 存钱线程 执行了<span class="keyword">wait</span>操作 -- i=<span class="number">1</span></span><br><span class="line"><span class="number">10</span> 存钱线程 存款:<span class="number">700</span><span class="variable">.0</span> -- i=<span class="number">2</span></span><br><span class="line"><span class="number">11</span> 存钱线程-- 存钱 -- 执行完毕 -- i=<span class="number">2</span></span><br><span class="line"><span class="number">12</span> 取钱线程 执行了<span class="keyword">wait</span>操作 执行了<span class="keyword">wait</span>操作 -- i=<span class="number">2</span></span><br><span class="line"><span class="number">13</span> 取钱线程 取钱：<span class="number">700</span><span class="variable">.0</span> -- i=<span class="number">3</span></span><br><span class="line"><span class="number">14</span> 取钱线程-- 取钱 -- 执行完毕 -- i=<span class="number">3</span></span><br><span class="line"><span class="number">15</span> 取钱线程 开始要执行<span class="keyword">wait</span>操作 执行了<span class="keyword">wait</span>操作 -- i=<span class="number">4</span></span><br><span class="line"><span class="number">16</span> 存钱线程 存款:<span class="number">700</span><span class="variable">.0</span> -- i=<span class="number">3</span></span><br><span class="line"><span class="number">17</span> 存钱线程-- 存钱 -- 执行完毕 -- i=<span class="number">3</span></span><br><span class="line"><span class="number">18</span> 存钱线程 开始要执行<span class="keyword">wait</span>操作 -- i=<span class="number">4</span></span><br><span class="line"><span class="number">19</span> 取钱线程 执行了<span class="keyword">wait</span>操作 执行了<span class="keyword">wait</span>操作 -- i=<span class="number">4</span></span><br><span class="line"><span class="number">20</span> 取钱线程 取钱：<span class="number">700</span><span class="variable">.0</span> -- i=<span class="number">5</span></span><br><span class="line"><span class="number">21</span> 取钱线程-- 取钱 -- 执行完毕 -- i=<span class="number">5</span></span><br><span class="line"><span class="number">22</span> 取钱线程 开始要执行<span class="keyword">wait</span>操作 执行了<span class="keyword">wait</span>操作 -- i=<span class="number">6</span></span><br><span class="line"><span class="number">23</span> 存钱线程 执行了<span class="keyword">wait</span>操作 -- i=<span class="number">4</span></span><br><span class="line"><span class="number">24</span> 存钱线程 存款:<span class="number">700</span><span class="variable">.0</span> -- i=<span class="number">5</span></span><br><span class="line"><span class="number">25</span> 存钱线程-- 存钱 -- 执行完毕 -- i=<span class="number">5</span></span><br><span class="line"><span class="number">26</span> 存钱线程 开始要执行<span class="keyword">wait</span>操作 -- i=<span class="number">6</span></span><br><span class="line"><span class="number">27</span> 取钱线程 执行了<span class="keyword">wait</span>操作 执行了<span class="keyword">wait</span>操作 -- i=<span class="number">6</span></span><br><span class="line"><span class="number">28</span> 取钱线程 取钱：<span class="number">700</span><span class="variable">.0</span> -- i=<span class="number">7</span></span><br><span class="line"><span class="number">29</span> 取钱线程-- 取钱 -- 执行完毕 -- i=<span class="number">7</span></span><br><span class="line"><span class="number">30</span> 取钱线程 开始要执行<span class="keyword">wait</span>操作 执行了<span class="keyword">wait</span>操作 -- i=<span class="number">8</span></span><br><span class="line"><span class="number">31</span> 存钱线程 执行了<span class="keyword">wait</span>操作 -- i=<span class="number">6</span></span><br><span class="line"><span class="number">32</span> 存钱线程 存款:<span class="number">700</span><span class="variable">.0</span> -- i=<span class="number">7</span></span><br></pre></td></tr></table></figure>



<p>由此，我们需要注意如下几点：</p>
<p>1.wait()方法执行后，当前线程立即进入到等待阻塞状态，其后面的代码不会执行；</p>
<p>2.notify()/notifyAll()方法执行后，将唤醒此同步锁对象上的（任意一个-notify()/所有-notifyAll()）线程对象，但是，此时还并没有释放同步锁对象，也就是说，如果notify()/notifyAll()后面还有代码，还会继续进行，知道当前线程执行完毕才会释放同步锁对象；</p>
<p>3.notify()/notifyAll()执行后，如果右面有sleep()方法，则会使当前线程进入到阻塞状态，但是同步对象锁没有释放，依然自己保留，那么一定时候后还是会继续执行此线程，接下来同2；</p>
<p>4.wait()/notify()/nitifyAll()完成线程间的通信或协作都是基于不同对象锁的，因此，如果是不同的同步对象锁将失去意义，同时，同步对象锁最好是与共享资源对象保持一一对应关系；</p>
<p>5.当wait线程唤醒后并执行时，是接着上次执行到的wait()方法代码后面继续往下执行的。</p>
<p>当然，上面的例子相对来说比较简单，只是为了简单示例wait()/notify()/noitifyAll()方法的用法，但其本质上说，已经是一个简单的生产者-消费者模式了。</p>

        </div>
        <footer class="article-footer">
            
    <div class="jiathis_style">
    <span class="jiathis_txt">分享到：</span>
    <a class="jiathis_button_qzone">QQ空间</a>
    <a class="jiathis_button_tsina">新浪微博</a>
    <a class="jiathis_button_tqq">腾讯微博</a>
    <a class="jiathis_button_weixin">微信</a>
    <a href="//www.jiathis.com/share" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank">更多</a>
    <a class="jiathis_counter_style"></a>
</div>
<script type="text/javascript" src="//v3.jiathis.com/code/jia.js" charset="utf-8"></script>
<style>
    .jiathis_style div:first-child:not(.jiadiv_01) {
        width: auto !important;
        border: none !important;
    }
    .jiathis_style .jiadiv_01 {
        margin: 10px 0;
        border-radius: 4px;
        border: #e1e1e1 solid 1px;
    }
    .jiathis_style .jiadiv_01 div:first-child {
        display: none;
    }
    .jiathis_style .jiadiv_02 {
        padding: 7px 0 !important;
    }
    .jiathis_style .jiadiv_02 .jiatitle {
        width: 85px;
        border: none;
        height: auto;
        margin: 3px 10px;
        padding: 6px 10px;
        border-radius: 4px;
    }
    .jiathis_style .jiadiv_02 .jiatitle:hover {
        border: none;
    }
    .jiathis_style .jiadiv_02 .jiatitle:nth-child(even) {
        margin-left: 0;
    }
    .jiathis_style .jtico:hover {
        opacity: 1;
    }
    .jiathis_style .ckepopBottom,
    .jiathis_style .centerBottom {
        width: auto !important;
        padding: 5px;
        background: #f7f7f7;
    }
</style>




        </footer>
    </div>
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "BlogPosting",
        "author": {
            "@type": "Person",
            "name": "John Doe"
        },
        "headline": "Java多线程学习",
        "image": "https://Conanisbest.github.io2020/07/02/first/sz.png",
        "keywords": "java",
        "genre": "",
        "datePublished": "2020-07-02",
        "dateCreated": "2020-07-02",
        "dateModified": "2020-07-03",
        "url": "https://Conanisbest.github.io/2020/07/02/second/",
        "description": "Java总结篇系列：Java多线程（一）
多线程作为Java中很重要的一个知识点，在此还是有必要总结一下的。
一.线程的生命周期及五种基本状态
关于Java中线程的生命周期，首先看一下下面这张较为经典的图：

上图中基本上囊括了Java中多线程各重要知识点。掌握了上图中的各知识点，Java中的多线程也就基本上掌握了。主要包括：
Java线程具有五种基本状态
新建状态（New）：当线程对象对创建后，",
        "wordCount": 8444
    }
</script>

</article>

    <section id="comments">
    
        
    <div id="disqus_thread">
        <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript" target="_blank" rel="noopener">comments powered by Disqus.</a></noscript>
    </div>


    
    </section>



                        </div>
                    </section>
                    <aside id="sidebar">
    <a class="sidebar-toggle" title="Expand Sidebar"><i class="toggle icon"></i></a>
    <div class="sidebar-top">
        <p>follow:</p>
        <ul class="social-links">
            
                
                <li>
                    <a class="social-tooltip" title="twitter" href="/" target="_blank" rel="noopener">
                        <i class="icon fa fa-twitter"></i>
                    </a>
                </li>
                
            
                
                <li>
                    <a class="social-tooltip" title="facebook" href="/" target="_blank" rel="noopener">
                        <i class="icon fa fa-facebook"></i>
                    </a>
                </li>
                
            
                
                <li>
                    <a class="social-tooltip" title="stack-overflow" href="/" target="_blank" rel="noopener">
                        <i class="icon fa fa-stack-overflow"></i>
                    </a>
                </li>
                
            
                
                <li>
                    <a class="social-tooltip" title="github" href="https://github.com/Conanisbest/Conanisbest.github.io" target="_blank" rel="noopener">
                        <i class="icon fa fa-github"></i>
                    </a>
                </li>
                
            
                
                <li>
                    <a class="social-tooltip" title="weibo" href="https://weibo.com/p/1005055084870318" target="_blank" rel="noopener">
                        <i class="icon fa fa-weibo"></i>
                    </a>
                </li>
                
            
                
                <li>
                    <a class="social-tooltip" title="rss" href="/" target="_blank" rel="noopener">
                        <i class="icon fa fa-rss"></i>
                    </a>
                </li>
                
            
        </ul>
    </div>
    
        
<nav id="article-nav">
    
        <a href="/2020/07/02/three/" id="article-nav-newer" class="article-nav-link-wrap">
        <strong class="article-nav-caption">newer</strong>
        <p class="article-nav-title">
        
            JVM 发生 OOM 的 8 种原因、及解决办法
        
        </p>
        <i class="icon fa fa-chevron-right" id="icon-chevron-right"></i>
    </a>
    
    
        <a href="/2020/07/02/first/" id="article-nav-older" class="article-nav-link-wrap">
        <strong class="article-nav-caption">older</strong>
        <p class="article-nav-title">Java高级特性——反射</p>
        <i class="icon fa fa-chevron-left" id="icon-chevron-left"></i>
        </a>
    
</nav>

    
    <div class="widgets-container">
        
            
                

            
                
    <div class="widget-wrap">
        <h3 class="widget-title">recents</h3>
        <div class="widget">
            <ul id="recent-post" class="">
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2020/07/07/java%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" class="thumbnail">
    
    
        <span style="background-image:url(2020/07/02/first/mz.png)" alt="java基础知识" class="thumbnail-image"></span>
    
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"></p>
                            <p class="item-title"><a href="/2020/07/07/java%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" class="title">java基础知识</a></p>
                            <p class="item-date"><time datetime="2020-07-07T06:46:42.000Z" itemprop="datePublished">2020-07-07</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2020/07/03/%E5%B7%A5%E4%BD%9C%E6%B5%81/" class="thumbnail">
    
    
        <span style="background-image:url(2020/07/03/工作流/1.png)" alt="工作流" class="thumbnail-image"></span>
    
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"></p>
                            <p class="item-title"><a href="/2020/07/03/%E5%B7%A5%E4%BD%9C%E6%B5%81/" class="title">工作流</a></p>
                            <p class="item-date"><time datetime="2020-07-03T08:25:36.000Z" itemprop="datePublished">2020-07-03</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2020/07/02/five/" class="thumbnail">
    
    
        <span style="background-image:url(2020/07/02/first/stbh.jpg)" alt="解决java导出文件时文件名中文不显示/乱码" class="thumbnail-image"></span>
    
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"></p>
                            <p class="item-title"><a href="/2020/07/02/five/" class="title">解决java导出文件时文件名中文不显示/乱码</a></p>
                            <p class="item-date"><time datetime="2020-07-02T07:39:23.000Z" itemprop="datePublished">2020-07-02</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2020/07/02/four/" class="thumbnail">
    
    
        <span style="background-image:url(2020/07/02/first/sdbh.jpg)" alt="hibernate工作原理及作用" class="thumbnail-image"></span>
    
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"></p>
                            <p class="item-title"><a href="/2020/07/02/four/" class="title">hibernate工作原理及作用</a></p>
                            <p class="item-date"><time datetime="2020-07-02T07:30:06.000Z" itemprop="datePublished">2020-07-02</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2020/07/02/three/" class="thumbnail">
    
    
        <span style="background-image:url(2020/07/02/first/zl.png)" alt="JVM 发生 OOM 的 8 种原因、及解决办法" class="thumbnail-image"></span>
    
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"></p>
                            <p class="item-title"><a href="/2020/07/02/three/" class="title">JVM 发生 OOM 的 8 种原因、及解决办法</a></p>
                            <p class="item-date"><time datetime="2020-07-02T07:26:13.000Z" itemprop="datePublished">2020-07-02</time></p>
                        </div>
                    </li>
                
            </ul>
        </div>
    </div>

            
                

            
                
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">archives</h3>
        <div class="widget">
            <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">July 2020</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a><span class="archive-list-count">1</span></li></ul>
        </div>
    </div>


            
                
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">tags</h3>
        <div class="widget">
            <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/JVM/" rel="tag">JVM</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/css/" rel="tag">css</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hibernate/" rel="tag">hibernate</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java/" rel="tag">java</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3/" rel="tag">问题解决</a><span class="tag-list-count">1</span></li></ul>
        </div>
    </div>


            
                
    <div class="widget-wrap widget-float">
        <h3 class="widget-title">tag cloud</h3>
        <div class="widget tagcloud">
            <a href="/tags/JVM/" style="font-size: 10px;">JVM</a> <a href="/tags/css/" style="font-size: 10px;">css</a> <a href="/tags/hibernate/" style="font-size: 10px;">hibernate</a> <a href="/tags/java/" style="font-size: 20px;">java</a> <a href="/tags/%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3/" style="font-size: 10px;">问题解决</a>
        </div>
    </div>


            
                
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">links</h3>
        <div class="widget">
            <ul>
                
                    <li>
                        <a href="http://hexo.io" target="_blank" rel="noopener">Hexo</a>
                    </li>
                
            </ul>
        </div>
    </div>


            
        
    </div>
</aside>

                </div>
            </div>
        </div>
        <footer id="footer">
    <div class="container">
        <div class="container-inner">
            <a id="back-to-top" href="javascript:;"><i class="icon fa fa-angle-up"></i></a>
            <div class="credit">
                <h1 class="logo-wrap">
                    <a href="/" class="logo"></a>
                </h1>
                <p>&copy; 2020 John Doe</p>
                
                <p>Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>. Theme by <a href="https://github.com/ppoffice" target="_blank">PPOffice</a></p>
                
                     <span id="busuanzi_container_site_pv">本站总访问量<span id="busuanzi_value_site_pv"></span>次</span>
            </div>
            <div class="footer-plugins">
              
    


            </div>
        </div>
    </div>   
<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
</footer>

    </div>
    
    
    <script>
    var disqus_shortname = 'hexo-theme-hueman';
    
    
    var disqus_url = 'https://conanisbest.github.io/2020/07/02/second/';
    
    (function() {
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
    </script>





    
        
<script src="/libs/lightgallery/js/lightgallery.min.js"></script>

        
<script src="/libs/lightgallery/js/lg-thumbnail.min.js"></script>

        
<script src="/libs/lightgallery/js/lg-pager.min.js"></script>

        
<script src="/libs/lightgallery/js/lg-autoplay.min.js"></script>

        
<script src="/libs/lightgallery/js/lg-fullscreen.min.js"></script>

        
<script src="/libs/lightgallery/js/lg-zoom.min.js"></script>

        
<script src="/libs/lightgallery/js/lg-hash.min.js"></script>

        
<script src="/libs/lightgallery/js/lg-share.min.js"></script>

        
<script src="/libs/lightgallery/js/lg-video.min.js"></script>

    
    
        
<script src="/libs/justified-gallery/jquery.justifiedGallery.min.js"></script>

    
    

    
    
    



<!-- Custom Scripts -->

<script src="/js/main.js"></script>


</body>
</html>
